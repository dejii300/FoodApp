{% extends "chops/base.html" %}
{% load static %}
{% block content %}

      <div class="row">
       
          
        <div class="col-lg-6">
            <div class="box-element">
                <a class="btn btn-outline-dark" href="{% url 'cart' %}"><i style='font-size:20px' class='fas fa-angle-left'></i> Back to cart</a>
                <hr>
                <h3>Order Summary</h3>
                <hr>
                
                {% for item in items %}
                <div class="cart-row">
                    <div style="flex:2"><img class="row-image" src="{{item.product.imageURL}}"></div>
                    <div style="flex:2"><p>{{item.product.name}}</p></div>
                    <div style="flex:1"><p>₦{{item.product.price}}</p></div>
                    <div style="flex:1"><p>x{{item.quantity}}</p></div>
                </div>
                {% endfor %}
             
                <h5>Items:   {{order.get_cart_items}}</h5>
                <h5>Delivery:   {{order.shippingaddress.delivery.price}}</h5>
                <h5>Total:   ₦{{finaltotal|floatformat:2}}</h5>
                <button type="submit" class="btn-success" onclick="payWithPaystack(event)"> Make payment</button>
              <script src="https://js.paystack.co/v1/inline.js"></script>

            </div>
            
            </div>
        </div>
    </div>
    <script>
        function payWithPaystack() {
            let currency = 'NGN';
            let plan = '';
            let ref = '{{payment.ref}}';
            let amount = '{{payment.amount}}';
            console.log("Amount Value:", amount);
            let obj = {
                key: '{{paystack_pub_key}}',
                email: '{{payment.customer.email}}',
                amount: '{{amount_value}}',
                ref:ref,
                callback: function (response) {
                    window.location.href = "{% url 'verify_order_payment' payment.ref %}";
                },
            };
        
            if (Boolean(currency)) {
                obj.currency = currency.toUpperCase();
            }
            if (Boolean(plan)) {
                obj.plan = plan;
            }
            var handler = PaystackPop.setup(obj);
            handler.openIframe();
        
        }
    </script>
    
{% endblock %}